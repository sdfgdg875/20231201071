# 百度百科风格项目学习总结报告

## 一、需求分析

### 1. 项目概述
本项目旨在开发一个模仿百度百科的简易百科系统，实现词条的创建、编辑、查看和管理功能，让用户可以浏览和贡献知识内容。

### 2. 功能需求

| 功能模块 | 具体需求 | 优先级 |
|---------|---------|-------|
| 词条管理 | 创建、编辑、删除、查看词条 | 高 |
| 分类系统 | 创建分类、按分类筛选词条 | 高 |
| 用户管理 | 登录认证、权限控制 | 中 |
| 浏览统计 | 记录词条浏览次数 | 低 |
| 相关推荐 | 显示相关词条 | 低 |

### 3. 技术需求

- 使用Django框架开发后端
- 实现前后端分离架构（前端使用HTML/CSS/JavaScript，后端提供API）
- 使用Bootstrap实现响应式界面设计
- 使用SQLite作为数据库

## 二、模块内容

### 1. 数据模型层（Models）

**Category（分类模型）**
- 存储百科分类信息
- 包含字段：分类名称、分类描述、创建时间
- 与Entry模型是一对多关系

**Entry（词条模型）**
- 存储百科词条信息
- 包含字段：标题、内容、所属分类、创建时间、更新时间、浏览次数
- 与Category模型是多对一关系

### 2. 视图控制层（Views）

**entry_list**
- 功能：显示词条列表，支持按分类筛选
- 访问权限：公开
- 返回模板：entry_list.html

**entry_detail**
- 功能：显示词条详细内容，自动增加浏览次数
- 访问权限：公开
- 返回模板：entry_detail.html

**entry_create**
- 功能：创建新词条
- 访问权限：仅登录用户
- 返回模板：entry_form.html

**entry_edit**
- 功能：编辑现有词条
- 访问权限：仅登录用户
- 返回模板：entry_form.html

**entry_delete**
- 功能：删除词条
- 访问权限：仅登录用户
- 返回模板：entry_confirm_delete.html

**category_create**
- 功能：创建新分类
- 访问权限：仅登录用户
- 返回模板：category_form.html

**category_entries**
- 功能：按分类查看词条列表
- 访问权限：公开
- 返回模板：entry_list.html

### 3. URL路由配置

| URL路径 | 视图函数 | 名称 | 功能描述 |
|---------|---------|------|--------|
| / | entry_list | entry_list | 首页显示词条列表 |
| /entry/<int:entry_id>/ | entry_detail | entry_detail | 词条详情页面 |
| /entry/create/ | entry_create | entry_create | 创建词条页面 |
| /entry/<int:entry_id>/edit/ | entry_edit | entry_edit | 编辑词条页面 |
| /entry/<int:entry_id>/delete/ | entry_delete | entry_delete | 删除词条确认页面 |
| /category/<int:category_id>/ | category_entries | category_entries | 按分类查看词条 |
| /category/create/ | category_create | category_create | 创建分类页面 |

### 4. 表单处理层（Forms）

**EntryForm**
- 基于Entry模型创建的表单
- 包含标题、内容、分类三个字段
- 自定义了小部件样式，提升用户体验

**CategoryForm**
- 基于Category模型创建的表单
- 包含名称、描述两个字段
- 添加了适当的占位符文本

### 5. 模板系统（Templates）

**base.html**
- 基础模板，定义了整体页面结构
- 包含导航栏、侧边栏、主内容区和页脚
- 引入了Bootstrap CSS和JavaScript

**entry_list.html**
- 词条列表页面，展示所有词条或按分类筛选的词条
- 显示词条标题、摘要、分类、创建时间等信息

**entry_detail.html**
- 词条详情页面，展示完整的词条内容
- 显示词条的所有元数据和统计信息
- 提供相关词条推荐功能

**entry_form.html**
- 词条创建/编辑页面，使用统一的表单模板
- 包含表单验证和错误提示

**category_form.html**
- 分类创建页面

**entry_confirm_delete.html**
- 词条删除确认页面，防止误操作

## 三、E-R图（实体关系图）

```
+---------------+        +---------------+
|   Category    |<------|     Entry     |
+---------------+        +---------------+
| - id          |        | - id          |
| - name        |        | - title       |
| - description |        | - content     |
| - created_at  |        | - category_id |
+---------------+        | - created_at  |
                         | - updated_at  |
                         | - view_count  |
                         +---------------+
```

**关系说明**：
- Category（分类）和Entry（词条）之间是一对多关系
- 一个分类可以包含多个词条
- 一个词条只能属于一个分类（也可以不属于任何分类）

## 四、完成后的截图

由于无法直接提供截图，以下是各个主要页面的功能描述：

1. **首页（词条列表页）**
   - 左侧显示分类列表，支持按分类筛选
   - 右侧显示词条列表，包含标题、摘要、创建时间等信息
   - 登录后显示创建、编辑、删除按钮

2. **词条详情页**
   - 显示完整的词条标题和内容
   - 显示词条的分类、创建时间、更新时间和浏览次数
   - 底部显示相关词条推荐

3. **创建/编辑词条页**
   - 包含词条标题、分类和内容三个字段
   - 表单验证和错误提示
   - 提供取消按钮返回上一页

4. **创建分类页**
   - 包含分类名称和描述两个字段
   - 名称为必填项，描述为可选项

## 五、核心功能代码实现

### 1. 数据模型定义（models.py）

```python
from django.db import models
from django.utils import timezone


class Category(models.Model):
    """百科分类模型"""
    name = models.CharField(max_length=100, verbose_name='分类名称')
    description = models.TextField(blank=True, null=True, verbose_name='分类描述')
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')
    
    def __str__(self):
        return self.name
    
    class Meta:
        verbose_name = '分类'
        verbose_name_plural = '分类管理'


class Entry(models.Model):
    """百科词条模型"""
    title = models.CharField(max_length=200, verbose_name='词条标题')
    content = models.TextField(verbose_name='词条内容')
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, blank=True, related_name='entries', verbose_name='所属分类')
    created_at = models.DateTimeField(default=timezone.now, verbose_name='创建时间')
    updated_at = models.DateTimeField(auto_now=True, verbose_name='更新时间')
    view_count = models.IntegerField(default=0, verbose_name='浏览次数')
    
    def __str__(self):
        return self.title
    
    class Meta:
        verbose_name = '词条'
        verbose_name_plural = '词条管理'
        ordering = ['-updated_at']  # 默认按更新时间倒序排列
```

### 2. 词条详情视图（views.py）

```python
def entry_detail(request, entry_id):
    """词条详情页面"""
    entry = get_object_or_404(Entry, pk=entry_id)
    # 增加浏览次数
    entry.view_count += 1
    entry.save()
    return render(request, 'hello/entry_detail.html', {'entry': entry})
```

### 3. 创建词条视图（views.py）

```python
@login_required
def entry_create(request):
    """创建词条"""
    if request.method == 'POST':
        form = EntryForm(request.POST)
        if form.is_valid():
            entry = form.save(commit=False)
            entry.save()
            return redirect('entry_detail', entry_id=entry.pk)
    else:
        form = EntryForm()
    return render(request, 'hello/entry_form.html', {'form': form, 'title': '创建新词条'})
```

### 4. 词条表单定义（forms.py）

```python
class EntryForm(forms.ModelForm):
    """词条表单"""
    content = forms.CharField(
        widget=forms.Textarea(attrs={'rows': 15, 'cols': 80, 'class': 'form-control'}),
        label='词条内容'
    )
    
    class Meta:
        model = Entry
        fields = ['title', 'content', 'category']
        widgets = {
            'title': forms.TextInput(attrs={'class': 'form-control', 'placeholder': '请输入词条标题'}),
            'category': forms.Select(attrs={'class': 'form-control'}),
        }
        labels = {
            'title': '词条标题',
            'category': '所属分类',
        }
```

## 六、调用流程示例图

### 词条创建流程

```
用户 --> 请求GET /entry/create/ --> entry_create视图 --> 渲染entry_form.html --> 显示创建表单
   |
   └--> 填写表单并提交 --> POST /entry/create/ --> entry_create视图 --> 验证表单
         |
         ├── 验证失败 --> 重新渲染entry_form.html（显示错误）
         |
         └── 验证成功 --> 保存Entry对象 --> 重定向到entry_detail页面
```

### 词条查看流程

```
用户 --> 请求GET /entry/[id]/ --> entry_detail视图 --> 查询Entry对象 --> 更新浏览次数 --> 渲染entry_detail.html --> 显示词条详情
```

### 按分类筛选流程

```
用户 --> 点击分类链接 --> 请求GET /category/[id]/ --> category_entries视图 --> 查询Category和相关Entry对象 --> 渲染entry_list.html --> 显示分类下的词条列表
```

## 七、总结与收获

### 1. 主要技术要点

- 掌握了Django的MTV（Model-Template-View）架构模式
- 学会了使用Django ORM进行数据库操作
- 了解了Django表单系统的使用方法
- 掌握了URL路由配置和视图函数的编写
- 学习了模板继承和Bootstrap的使用

### 2. 遇到的问题与解决方案

- **问题**：权限控制问题
  **解决**：使用@login_required装饰器限制需要登录的操作

- **问题**：表单验证和错误提示
  **解决**：利用Django的表单系统自动处理验证和错误显示

- **问题**：页面布局和样式
  **解决**：使用Bootstrap框架实现响应式设计

### 3. 后续改进方向

- 添加富文本编辑器支持
- 实现搜索功能
- 增加用户评论系统
- 优化页面加载速度
- 添加用户注册功能
- 实现更复杂的权限管理

通过本项目的开发，我对Django框架有了更深入的理解，能够熟练运用Django开发Web应用。同时，也提高了数据库设计、前端开发和项目管理的能力。